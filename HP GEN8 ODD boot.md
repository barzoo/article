# HP MicroServer Gen8 光驱位启动操作系统

HP Gen8 除了标配的四个硬盘，在服务器的顶部，还有一个安装光驱的位置 ( 也成为ODD )，很多使用者都将这里改造后安装一个2.5寸的SSD硬盘作为系统盘。不过在各个论坛上，经常讨论如何将这个硬盘为系统启动盘。



## 为什么要用光驱位直接启动？

根本的问题出自 HP Gen8 这个电脑的设计，作为一台服务器，并没有向普通电脑一样可以设置任何一个硬盘都可以随意成为启动盘。如果采用AHCI模式( Serial ATA Advanced Host Controller Interface )，启动盘只能是SATA1或者TF存储卡。

Gen8只有四个标准的硬盘安装位，支持快速插拔。如果使用了第一个硬盘来做系统盘，首先会占用较多的空间放置系统程序和数据，同时这个硬盘损坏后更换，也就涉及到系统的重新安装和设置，对NAS的使用维护添加额外的麻烦。另外，如果采用软件或者硬件方式RAID来进行冗余存储数据，更需要四个数据盘只存放数据，而非操作系统。

目前，从光驱位（ODD）的硬盘启动操作系统，目前市面上还流传有一种方法：将grub安装到一个TF (MICRO SD)存储卡作为启动盘，在启动后通过它跳转到SATA5对应的盘符上。不过这个方法需要很多命令行的操作，如果驱动器号没有配置正确或者操作系统相关的配置有误，就会无法启动。并不是一种老少皆宜的简单办法。另外，为了启动一个几十个G的操作系统盘，还要买一个TF卡，实在是像是花冤枉钱。

还有一种硬件修改的办法，就是将 SATA1 和 SATA5 的接线换一下，深水宝上可能有现成品简化一些接线的工作。不过这方法还是比较适合动手能力强的人。而且 SATA1 是 6GB/s 的接口，用在操作系统上有点可惜了。

如果Gen8能和一般电脑一样灵活的设置，就不会出现这样一个问题。不过，HP 服务器其实来还是预留了一个变通的方法， 不用以上各种折腾就能无痛的实现光驱位第五个SATA的启动。

## 操作步骤

### 1. 只留下系统盘

拆除所有其他硬盘，只留下光驱位的系统盘。

这时候这个磁盘可以是空白，没有安装操作系统的。如果没有安装操作系统，先从第一步走到第四步，然后用 iLO 安装操作系统，验证一切都没有问题了，在修改启动盘的优先级。

### 2. 打开 iLO 窗口

所有的操作都是在iLO下进行的，所以需要确定iLO的网线口联好了网络，并让一台电脑访问这个地址 https://192.168.1.xxx，使用管理员账号 `administrator`登录。打开 `Remote Console` 访问Gen8服务器，并启动服务器。

在启动过程中，看见进度条和按下`F9`进入`Setup`菜单的时候，按下`F9`进入设置界面。

### 3. 使能B120i 控制器

按下`F9`进入BIOS后，按照如下的菜单来设置使能B120i磁盘阵列控制器。

```
System Options 
  >> SATA Controller Options 
    >> Embedded SATA Configuration
      >> Enable HP Dynamic Smart Array B120i Controller
```

重启服务器，好了，我们就可以进入最为重要的一步。

### 4. 建立阵列服务

接下来的操作，我们将安装在光驱位的SSD盘建立了一个虚拟的 RAID 0 卷，也就是 Local – logical Drive 1。如果之前已经建立过RAID卷，请删除，务必保证只有一个RAID 0 卷，而且这个卷只有我们这个在光驱位的系统盘。

再次启动，继续启动进度条的界面中按下`F9`进入 **Perform  Maintenance** 界面。选择进入 HP Smart Storage Administrator (SSA) 智能存储管理的界面。

在左侧的 Configura 菜单中选择 **Dynamic Smart Array B120i RAID** 项，并选择 **Set Bootable Logical Drive/Volume**  来建立可以启动的逻辑驱动/卷。在出现的磁盘列表中选择第一个 **Local – logical Drive 1** 作为 **Primary Boot Logical Drive/Volume** 主启动逻辑盘/卷。然后OK保存。

退出当前页面，重启服务器。接下来，我们就可以用这个虚拟的设置为启动盘。

### 5. 设置启动盘

再次启动，继续启动进度条的界面中按下`F9`进入 BIOS 设置。

选择**Standard Boot Order (IPL)** 菜单，在回车后，通过调整启动盘的顺序，将 **IPL:1**  设置为第一启动优先级。

退出BIOS，并按`F10`保存设置，重启服务器，这时候服务器应该可以直接从第五个硬盘的接口启动操作系统了。

